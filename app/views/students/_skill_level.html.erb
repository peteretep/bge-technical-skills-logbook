<!-- app/views/students/_skill_level.html.erb -->

<%
  border_color = case level
  when :bronze then 'border-bronze'
  when :silver then 'border-silver'
  when :gold then 'border-gold'
  end
  
  text_color = case level
  when :bronze then 'text-orange-700'
  when :silver then 'text-gray-600'
  when :gold then 'text-yellow-600'
  end
  
  percentage = skills.count > 0 ? (demonstrated_count.to_f / skills.count * 100).round : 0
%>

<div class="border-l-4 <%= border_color %> pl-4">
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center gap-2 flex-wrap">
      <span class="text-xl"><%= icon %></span>
      <span class="font-bold <%= text_color %>"><%= level_name %> LEVEL</span>
      
      <% if has_badge %>
        <span class="px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full">Badge Awarded</span>
      <% elsif percentage >= 75 %>
        <span class="px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full">Ready for Badge (<%= percentage %>%)</span>
      <% elsif percentage > 0 %>
        <span class="px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded-full"><%= percentage %>% complete</span>
      <% end %>
    </div>
    
    <div class="flex items-center gap-3">
      <div class="text-sm text-gray-600"><%= demonstrated_count %>/<%= skills.count %> demonstrated</div>
      <% if ready_for_badge %>
        <%= button_to "Award #{level_name.capitalize} Badge", 
            award_badge_student_path(student, section_id: section.id, level: level),
            method: :post,
            data: { turbo_confirm: "Award #{level_name} badge to #{student.full_name}?" },
            class: "px-3 py-1 bg-gradient-to-r #{level == :bronze ? 'from-orange-500 to-orange-600' : level == :silver ? 'from-gray-400 to-gray-500' : 'from-yellow-500 to-yellow-600'} text-white text-sm rounded-lg font-medium hover:opacity-90" %>
      <% end %>
    </div>
  </div>
  
  <div class="space-y-2">
    <% skills.each do |skill| %>
      <%
        student_skill = student.student_skills.find_by(skill: skill)
        is_demonstrated = student_skill&.demonstrated? || false
      %>
      
      <div class="flex items-center gap-3 py-2 px-3 <%= is_demonstrated ? 'bg-green-50' : 'bg-gray-50 hover:bg-gray-100' %> rounded transition">
        <%= check_box_tag "skill_#{skill.id}", 
            "1", 
            is_demonstrated,
            data: { 
              student_id: student.id,
              skill_id: skill.id,
              action: "change->skills#toggle"
            },
            class: "w-4 h-4" %>
        <span class="text-sm flex-1 <%= is_demonstrated ? '' : 'text-gray-700' %>">
          <%= skill.description %>
        </span>
        <% if is_demonstrated && student_skill.demonstrated_at %>
          <span class="text-xs text-gray-500"><%= student_skill.demonstrated_at.strftime('%d %b') %></span>
        <% end %>
      </div>
    <% end %>
  </div>
</div>